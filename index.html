<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Telegram Web Apps SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <title>podpiska.org</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Inter:wght@400;500;600;700&display=swap');
    
    :root {
      /* podpiska.org Colors */
      --primary-red: #f65e49;
      --primary-white: #ffffff;
      --primary-black: #161616;
      --dark-red: #e54b36;
      --light-gray: #f8f9fa;
      --medium-gray: #6c757d;
      --border-color: #e1e5e9;
      --shadow-strong: 0 12px 40px rgba(0, 0, 0, 0.15);
      --shadow-medium: 0 6px 20px rgba(0, 0, 0, 0.1);
      --shadow-light: 0 2px 8px rgba(0, 0, 0, 0.06);
      --border-radius: 16px;
      --border-radius-small: 12px;
      --gradient-fire: linear-gradient(135deg, #f65e49 0%, #e54b36 100%);
      --gradient-bg: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      --telegram-bg: #ffffff;
      --telegram-secondary-bg: #f7f7f7;
      --telegram-text: #000000;
      --telegram-link: #168acd;
      --telegram-button: #40a7e3;
      --telegram-destructive: #e53935;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--telegram-bg);
      color: var(--telegram-text);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Menu Section */
    .menu {
      background: #161616;
      padding: 1.5rem 1rem;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .menu::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
      animation: rotate 20s linear infinite;
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .menu-content {
      position: relative;
      z-index: 2;
    }

    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 0.75rem;
      max-width: 600px;
      margin: 0 auto;
    }

    .menu-item {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--border-radius);
      padding: 0.5rem 0.75rem;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .menu-item:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
    }

    .menu-item.active {
      background: var(--primary-red);
      border-color: var(--dark-red);
    }

    .menu-item-logo {
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.9);
      border-radius: var(--border-radius-small);
      flex-shrink: 0;
    }

    .menu-item-logo svg {
      width: 18px;
      height: 18px;
    }

    .menu-item-name {
      color: white;
      font-size: 0.875rem;
      font-weight: 500;
    }

    /* Container */
    .container {
      max-width: 480px;
      margin: 0 auto;
      padding: 1.5rem 1rem;
    }

    /* Categories */
    .categories-container {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .category-section {
      background: var(--telegram-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      box-shadow: var(--shadow-light);
    }

    .category-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--telegram-text);
      text-align: left;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border-color);
    }

    /* Country Sections */
    .country-section {
      margin-bottom: 1.5rem;
    }

    .country-section:last-child {
      margin-bottom: 0;
    }

    .country-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
      padding: 0.5rem 0.75rem;
      background: var(--telegram-secondary-bg);
      border-radius: var(--border-radius-small);
      border: 1px solid var(--border-color);
    }

    .country-flag-large {
      font-size: 1.25rem;
      width: 1.5rem;
      height: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .country-name {
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--telegram-text);
    }

    /* Product Grid */
    .products-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }

    /* Product Card */
    .product-card {
      background: var(--telegram-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-light);
      overflow: hidden;
      transition: all 0.2s ease;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: 1rem 0.75rem;
    }

    .product-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
      border-color: var(--telegram-link);
    }

    .product-card:active {
      transform: translateY(0);
      box-shadow: var(--shadow-light);
    }

    .logo-container {
      width: 60px;
      height: 60px;
      border-radius: var(--border-radius-small);
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--telegram-secondary-bg);
      border: 1px solid var(--border-color);
      box-shadow: var(--shadow-light);
      position: relative;
      overflow: visible;
      margin-bottom: 0.75rem;
    }

    .logo-container svg {
      width: 36px;
      height: 36px;
    }

    .product-title {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--telegram-text);
      margin-bottom: 0.75rem;
      line-height: 1.3;
      min-height: 2.3em;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .buy-button {
      width: 100%;
      background: var(--telegram-button);
      border: none;
      border-radius: var(--border-radius-small);
      padding: 0.75rem;
      font-size: 1rem;
      font-weight: 700;
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
    }

    .buy-button:hover {
      background: #2b96d6;
      transform: translateY(-1px);
    }

    .buy-button:active {
      transform: translateY(0);
      background: #1e88c7;
    }

    .star-icon {
      width: 1.2em;
      height: 1.2em;
    }

    /* Loading State */
    .loading {
      text-align: center;
      padding: 2rem;
      color: var(--telegram-text);
    }

    .loading::after {
      content: '';
      width: 30px;
      height: 30px;
      border: 3px solid var(--border-color);
      border-top: 3px solid var(--telegram-button);
      border-radius: 50%;
      display: inline-block;
      animation: spin 1s linear infinite;
      margin-left: 1rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 1rem 0.75rem;
      }
      
      .products-grid {
        gap: 0.5rem;
      }

      .menu-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 480px) {
      .container {
        padding: 0.75rem 0.5rem;
      }
      
      .product-card {
        padding: 0.75rem 0.5rem;
      }

      .logo-container {
        width: 50px;
        height: 50px;
        margin-bottom: 0.5rem;
      }

      .logo-container svg {
        width: 30px;
        height: 30px;
      }

      .product-title {
        font-size: 0.8rem;
        margin-bottom: 0.6rem;
      }

      .buy-button {
        padding: 0.6rem;
        font-size: 0.9rem;
      }

      .menu-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .menu-item {
        padding: 0.75rem 0.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="menu">
    <div class="menu-content">
      <div class="menu-grid" id="menu-grid">
        <!-- Меню будет загружено динамически -->
      </div>
    </div>
  </div>

  <div class="container">
    <div id="products-container">
      <div class="loading">Загружаем хиты продаж...</div>
    </div>
  </div>

  <script>
    const tg = window.Telegram?.WebApp;
    const container = document.getElementById('products-container');
    const menuGrid = document.getElementById('menu-grid');

    // Настройка Telegram WebApp
    tg?.ready?.();
    tg?.setHeaderColor?.('#f65e49');
    tg?.setBackgroundColor?.('#ffffff');

    // Состояние приложения
    let allCategories = [];
    let currentFilter = null;

    // Хиты продаж с их ID
    const hitProducts = [
      'spotify_india_12m', // Spotify Индия 12 мес
      'apple_turkey_500tl', // Apple 500 TL
      'playstation_poland_200pln', // Playstation 200 PLN
      'roblox_russia_800robux', // Roblox 800 Robux
      'netflix_turkey_500tl' // Netflix 500 TL
    ];

    // Логотипы брендов
    const brandLogos = {
      'Spotify': `<svg viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><path d="M128 0C57.308 0 0 57.309 0 128c0 70.696 57.309 128 128 128 70.697 0 128-57.304 128-128C256 57.314 198.697.007 127.998.007l.001-.006Zm58.699 184.614c-2.293 3.76-7.215 4.952-10.975 2.644-30.053-18.357-67.885-22.515-112.44-12.335a7.981 7.981 0 0 1-9.552-6.007 7.968 7.968 0 0 1 6-9.553c48.76-11.14 90.583-6.344 124.323 14.276 3.76 2.308 4.952 7.215 2.644 10.975Zm15.667-34.853c-2.89 4.695-9.034 6.178-13.726 3.289-34.406-21.148-86.853-27.273-127.548-14.92-5.278 1.594-10.852-1.38-12.454-6.649-1.59-5.278 1.386-10.842 6.655-12.446 46.485-14.106 104.275-7.273 143.787 17.007 4.692 2.89 6.175 9.034 3.286 13.72v-.001Zm1.345-36.293C162.457 88.964 94.394 86.71 55.007 98.666c-6.325 1.918-13.014-1.653-14.93-7.978-1.917-6.328 1.65-13.012 7.98-14.935C93.27 62.027 168.434 64.68 215.929 92.876c5.702 3.376 7.566 10.724 4.188 16.405-3.362 5.69-10.73 7.565-16.4 4.187h-.006Z" fill="#1ED760"/></svg>`,
      
      'Apple': `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 814 1000"><path d="M788.1 340.9c-5.8 4.5-108.2 62.2-108.2 190.5 0 148.4 130.3 200.9 134.2 202.2-.6 3.2-20.7 71.9-68.7 141.9-42.8 61.6-87.5 123.1-155.5 123.1s-85.5-39.5-164-39.5c-76.5 0-103.7 40.8-165.9 40.8s-105.6-57-155.5-127C46.7 790.7 0 663 0 541.8c0-194.4 126.4-297.5 250.8-297.5 66.1 0 121.2 43.4 162.7 43.4 39.5 0 101.1-46 176.3-46 28.5 0 130.9 2.6 198.3 99.2zm-234-181.5c31.1-36.9 53.1-88.1 53.1-139.3 0-7.1-.6-14.3-1.9-20.1-50.6 1.9-110.8 33.7-147.1 75.8-28.5 32.4-55.1 83.6-55.1 135.5 0 7.8 1.3 15.6 1.9 18.1 3.2.6 8.4 1.3 13.6 1.3 45.4 0 102.5-30.4 135.5-71.3z"/></svg>`,
      
      'Netflix': `<svg viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h255.904v255.904H0z"/><path d="m141.676 41.275-.067 38.361-.068 38.361-3.156-8.905-.006-.017-4.078 85.402c4.01 11.324 6.158 17.369 6.182 17.393.031.032 2.317.17 5.078.307 8.366.415 18.734 1.304 26.599 2.282 1.821.226 3.388.342 3.483.257.094-.084.145-39.143.114-86.797l-.058-86.644H141.676ZM80.138 41.16v86.732c0 47.703.047 86.779.104 86.836.057.057 3.011-.222 6.565-.62 3.553-.398 8.465-.893 10.914-1.1 3.756-.317 14.97-1.038 16.268-1.046.378-.002.402-1.95.457-36.735l.058-36.734 2.713 7.677.96 2.713 4.077-85.381-1.401-3.96a32065.7 32065.7 0 0 0-6.283-17.754l-.225-.628H80.138Z" fill="#B1060F"/><path d="m80.139 41.16 34.365 97.377v-.044l2.713 7.677c15.104 42.738 23.218 65.652 23.266 65.7.031.032 2.317.17 5.078.307 8.366.415 18.734 1.304 26.599 2.282 1.812.225 3.37.34 3.48.258L141.54 117.98v.017l-3.156-8.905c-3.084-8.701-5.143-14.52-17.532-49.55-3.332-9.42-6.159-17.408-6.283-17.754l-.225-.628H80.139Z" fill="#E50914"/></svg>`,
      
      'PlayStation': `<svg viewBox="0 0 122.88 95.18" xmlns="http://www.w3.org/2000/svg"><path d="M2.49,69.39c-4.61,3.07-3.07,8.9,6.75,11.67c10.13,3.38,21.18,4.3,31.93,2.46c0.61,0,1.23-0.31,1.54-0.31 V72.76l-10.44,3.38c-3.99,1.23-7.98,1.54-11.97,0.61c-3.07-0.92-2.46-2.76,1.23-4.3l21.18-7.37V53.73L13.23,63.86 C9.55,65.09,5.86,66.93,2.49,69.39L2.49,69.39z M73.71,23.33v29.78c12.59,6.14,22.41,0,22.41-15.96c0-16.27-5.83-23.64-22.72-29.47 C64.5,4.6,55.29,1.84,46.08,0v88.73l21.49,6.45V20.57c0-3.38,0-5.83,2.46-4.91C73.41,16.58,73.71,19.96,73.71,23.33L73.71,23.33z M113.63,62.32c-8.9-3.07-18.42-4.3-27.63-3.38c-4.91,0.31-9.52,1.54-13.82,3.07l-0.92,0.31V74.3l19.96-7.37 c3.99-1.23,7.98-1.54,11.97-0.61c3.07,0.92,2.46,2.76-1.23,4.3l-30.7,11.36v11.67l42.37-15.66c3.07-1.23,5.83-2.76,8.29-5.22 C124.07,69.69,123.15,65.39,113.63,62.32L113.63,62.32z" fill="#0070D1"/></svg>`,
      
      'Roblox': `<svg viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h256v256H0z" fill="#000"/><path d="M79.429 35.714L176.571 220.286 192 223.714 94.857 39.143z" fill="#fff"/><path d="M94.857 39.143l-15.428-3.429v184.572l97.143-184.572h15.428L94.857 220.286H79.429V35.714z" fill="#fff"/></svg>`,
      
      'Nintendo': `<svg viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><path d="M158.628 22.328C171.419 22.328 182 32.909 182 45.7v164.6c0 12.791-10.581 23.372-23.372 23.372H97.372C84.581 233.672 74 223.091 74 210.3V45.7c0-12.791 10.581-23.372 23.372-23.372h61.256z" fill="#E60012"/><path d="M158.628 22.328C171.419 22.328 182 32.909 182 45.7v164.6c0 12.791-10.581 23.372-23.372 23.372H97.372C84.581 233.672 74 223.091 74 210.3V45.7c0-12.791 10.581-23.372 23.372-23.372h61.256zm-12.791 46.744c-12.791 0-23.372 10.581-23.372 23.372s10.581 23.372 23.372 23.372 23.372-10.581 23.372-23.372-10.581-23.372-23.372-23.372z" fill="#fff"/></svg>`,
      
      'Xbox': `<svg viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><circle cx="128" cy="128" r="128" fill="#107C10"/><path d="M190.5 88.5c-25.5-25.5-59.5-39.5-95.5-39.5s-70 14-95.5 39.5c-2 2-2 5.5 0 7.5l88 88c2 2 5.5 2 7.5 0l88-88c2-2 2-5.5 0-7.5z" fill="#fff"/></svg>`
    };

    // Флаги стран
    const countryFlags = {
      'IN': '🇮🇳',
      'TR': '🇹🇷',
      'PL': '🇵🇱',
      'RU': '🇷🇺',
      'ID': '🇮🇩',
      'US': '🇺🇸'
    };

    // Названия стран
    const countryNames = {
      'IN': 'Индия',
      'TR': 'Турция',
      'PL': 'Польша',
      'RU': 'Россия',
      'ID': 'Индонезия',
      'US': 'США'
    };

    // SVG иконка звезды
    function starSVG() {
      return `<svg class="star-icon" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="star-gradient" x1="10" y1="1.5" x2="10" y2="18.5" gradientUnits="userSpaceOnUse">
            <stop stop-color="#FFD700"/>
            <stop offset="1" stop-color="#FFA500"/>
          </linearGradient>
        </defs>
        <path d="M7.26843 6.25162L9.28943 2.22541C9.52311 1.76121 10.0884 1.5749 10.5494 1.80857C10.7294 1.90015 10.8747 2.04857 10.9662 2.23172L12.8767 6.11583C13.0314 6.43477 13.3378 6.64951 13.6883 6.69056L17.6829 7.17055C18.2261 7.23686 18.6145 7.73264 18.5513 8.27894C18.5229 8.50314 18.4218 8.71156 18.2608 8.86945L15.0998 11.9862C14.9703 12.1125 14.9103 12.2894 14.9324 12.4694L15.4598 16.6756C15.5356 17.2787 15.1093 17.8282 14.5093 17.904C14.2819 17.9324 14.0546 17.8913 13.8525 17.7808L10.5147 15.9556C10.2715 15.823 9.98099 15.8198 9.73784 15.9461L6.27687 17.7208C5.79057 17.9703 5.1969 17.7745 4.94743 17.285C4.8527 17.1019 4.82112 16.8966 4.84954 16.6945L5.12427 14.7619C5.26006 13.8177 5.84425 12.9967 6.69055 12.5641L10.5305 10.6031C10.6315 10.5526 10.6726 10.4263 10.622 10.322C10.581 10.2431 10.4957 10.1957 10.4073 10.2084L5.70847 10.8841C4.99164 10.9852 4.26535 10.7831 3.7001 10.322L2.13698 9.04629C1.69173 8.68314 1.6191 8.02 1.98225 7.57159C2.15277 7.36317 2.39592 7.22739 2.66118 7.19265L6.6716 6.67793C6.92739 6.64319 7.15159 6.4853 7.26843 6.25162Z" fill="url(#star-gradient)"/>
      </svg>`;
    }

    // Функция для замены лир на TL
    function formatDenomination(denomination) {
      return denomination.replace(/лир/g, 'TL').replace(/лира/g, 'TL');
    }

    // Загрузка и отображение товаров
    fetch('catalog.json')
      .then(response => response.json())
      .then(data => {
        allCategories = data.categories;
        renderMenu(allCategories);
        // По умолчанию показываем первый сервис
        if (allCategories.length > 0) {
          showService(allCategories[0].id);
        }
      })
      .catch(error => {
        container.innerHTML = '<div class="loading">Ошибка загрузки товаров</div>';
        console.error('Ошибка:', error);
      });

    // Отображение меню
    function renderMenu(categories) {
      menuGrid.innerHTML = '';
      
      // Добавляем кнопки сервисов
      categories.forEach((category, index) => {
        const menuItem = document.createElement('div');
        menuItem.className = index === 0 ? 'menu-item active' : 'menu-item';
        menuItem.innerHTML = `
          <div class="menu-item-logo">
            ${brandLogos[category.name] || '<div style="width:18px;height:18px;background:#ddd;border-radius:4px;"></div>'}
          </div>
          <div class="menu-item-name">${category.name}</div>
        `;
        menuItem.addEventListener('click', () => showService(category.id));
        menuGrid.appendChild(menuItem);
      });
    }

    // Показать все товары сервиса
    function showService(serviceId) {
      currentFilter = serviceId;
      updateMenuActiveState(serviceId);
      const category = allCategories.find(cat => cat.id === serviceId);
      if (category) {
        renderServiceProducts(category);
      }
    }

    // Обновить активное состояние меню
    function updateMenuActiveState(activeServiceId) {
      const menuItems = menuGrid.querySelectorAll('.menu-item');
      menuItems.forEach((item, index) => {
        if (activeServiceId === allCategories[index].id) {
          item.classList.add('active');
        } else {
          item.classList.remove('active');
        }
      });
    }



    // Отображение товаров конкретного сервиса
    function renderServiceProducts(category) {
      container.innerHTML = '';
      container.className = 'categories-container';
      
      const categoryDiv = document.createElement('div');
      categoryDiv.className = 'category-section';
      
      const categoryHeader = document.createElement('h2');
      categoryHeader.className = 'category-title';
      categoryHeader.textContent = category.name;
      categoryDiv.appendChild(categoryHeader);
      
      // Группируем продукты по странам
      const productsByCountry = {};
      category.products.forEach(product => {
        if (!productsByCountry[product.country]) {
          productsByCountry[product.country] = [];
        }
        productsByCountry[product.country].push(product);
      });
      
      // Отображаем продукты, сгруппированные по странам
      Object.keys(productsByCountry).forEach(country => {
        const countryProducts = productsByCountry[country];
        
        // Создаем секцию для страны
        const countrySection = document.createElement('div');
        countrySection.className = 'country-section';
        
        // Заголовок страны
        const countryHeader = document.createElement('div');
        countryHeader.className = 'country-header';
        countryHeader.innerHTML = `
          <div class="country-flag-large">${countryFlags[countryProducts[0].country_code] || '🌍'}</div>
          <div class="country-name">${countryNames[countryProducts[0].country_code] || country}</div>
        `;
        countrySection.appendChild(countryHeader);
        
        // Сетка продуктов для этой страны
        const productsGrid = document.createElement('div');
        productsGrid.className = 'products-grid';
        
        countryProducts.forEach(product => {
          const card = document.createElement('div');
          card.className = 'product-card';
          
          // Формируем название: "Номинал"
          const title = formatDenomination(product.denomination);
          
                     card.innerHTML = `
             <div class="logo-container">
               ${brandLogos[product.brand] || '<div style="width:36px;height:36px;background:#ddd;border-radius:6px;"></div>'}
             </div>
             <div class="product-title">${title}</div>
             <button class="buy-button" onclick="buyProduct('${product.id}')">
               ${product.price_stars} ${starSVG()}
             </button>
           `;
          
          productsGrid.appendChild(card);
        });
        
        countrySection.appendChild(productsGrid);
        categoryDiv.appendChild(countrySection);
      });
      
      container.appendChild(categoryDiv);
    }

    // Функция покупки
    async function buyProduct(productId) {
      try {
        const response = await fetch(`https://functions.yandexcloud.net/d4e8d2h199cdcsnfhai7?item=${productId}`);
        const data = await response.json();
        
        if (data.invoiceLink) {
          tg.openInvoice(data.invoiceLink);
        } else {
          tg.showAlert('Ошибка создания счета: ' + (data.error || 'Неизвестная ошибка'));
        }
      } catch (error) {
        tg.showAlert('Ошибка: ' + error.message);
      }
    }
  </script>
</body>
</html>